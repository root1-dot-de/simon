#################################################################################################
# TODO:
#

- We have pakets which are fixed in size, and we have packets, which are not. 
- Sending the paket size should depend on the paket type
--> only hashcode-return and equals-return have a fixed size. So it's not an real performance-issue
    to send ALWAYS the size of the packet after the packet-type.
- That means, there should be a packet-handler, checking the type and deciding what to do with it.
- And because Strings and object have a dynamic size: Each dynamic "part" should know his own length
- And this means, the serialization should be extended for strings and objects.
- Before serialization, we know what type it is. And for the return-value, we know what we expect.
- "Unknown" Types, are also objects -> Object.class; Same counts for "Exceptions".

Notes:
- String serialization with ObjectOutputStream -> Overhead: 11 Bytes (this seems to be constant)
- invokeXYZ is done by the client. Each invoke method waits for the result before finishing.
  The result is received by the PacketProcessor. And the PP must store the result in a Map and 
  notify the waiting invoke-method.
- SelectionKey Ops:
  bit 0 ( 1) -> read
  bit 1 ( 2) -> -
  bit 2 ( 4) -> write
  bit 3 ( 8) -> connect
  bit 4 (16) -> accept
- some more documentation on nio: http://today.java.net/cs/user/print/a/350

	


#################################################################################################
# Overall packet structure for NIO implementation:
#
+------------------------------------------------------------------------------------------------
|	Packet overall structure		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	9		|	n/a		|	packet header
|	10		|	x		|	n/a		|	packet body
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	Packet header		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	1		|	Byte	|	packet type (part1/3 of packet header)
|	1		|	4		|	Integer	|	request id (part2/3 of packet header)
|	6		|	4		|	Integer	|	length of following paket (part3/3 of packet header)
+-----------+-----------+-----------+------------------------------------------------------------

+-----------+-----------+-----------+------------------------------------------------------------
Packet body descriptions:
+-----------+-----------+-----------+------------------------------------------------------------
+------------------------------------------------------------------------------------------------
|	LOOKUP_PACKET = 0x00		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	name of remote object in lookuptable
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	LOOKUP_RETURN_PACKET = 0x01		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	Object	|	requested remote object interface
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	INVOCATION_PACKET = 0x02		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	name of remote object
|	x		|	8		|	Long	|	method-hash
|	x+8		|	y		|	n/a		|	method parameters: array of primitives and objects
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	INVOCATION_RETURN_PACKET = 0x03		
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	n/a		|	return value from method invocation: primitive or object
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	TOSTRING_PACKET	= 0x04
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	name of remote object in lookuptable
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	TOSTRING_RETURN_PACKET = 0x05	
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	String representation of remote object
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	HASHCODE_PACKET	= 0x06	
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	name of remote object in lookuptable
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	HASHCODE_RETURN_PACKET = 0x07
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	4		|	Integer	|	hash code of remote object
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	EQUALS_PACKET = 0x08
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	x		|	String	|	name of remote object in lookuptable
|	x		|	y		|	Object	|	object to compare with
+-----------+-----------+-----------+------------------------------------------------------------

+------------------------------------------------------------------------------------------------
|	EQUALS_RETURN_PACKET = 0x09
+-----------+-----------+-----------+------------------------------------------------------------
|	index	|	length	|	type	|	description
+-----------+-----------+-----------+------------------------------------------------------------
|	0		|	1		|	Boolean	|	true or false return value
+-----------+-----------+-----------+------------------------------------------------------------